---
title: "npm åŒ…ä¾èµ–ç®¡ç†æœ€ä½³å®è·µï¼šdependencies ä¸ peerDependencies æ·±åº¦è§£æ"
description: "æ·±å…¥æ¢è®¨ npm ä¸­ dependencies å’Œ peerDependencies çš„åŒºåˆ«ã€å®‰è£…è¡Œä¸ºã€æ‰“åŒ…å½±å“ä»¥åŠæœ€ä½³å®è·µï¼Œå¸®åŠ©å¼€å‘è€…é¿å…ä¾èµ–å†²çªå’Œå†—ä½™å®‰è£…ã€‚"
keywords: "npm, dependencies, peerDependencies, package.json, node_modules, æ‰“åŒ…, webpack, externals, ä¾èµ–ç®¡ç†, å‰ç«¯å¼€å‘, JavaScript, Node.js, æœ€ä½³å®è·µ, ç‰ˆæœ¬å†²çª, å…±äº«ä¾èµ–"
---

==================================================

peerDependencies å’Œ dependencies åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«

==================================================

åœ¨ npm çš„ `package.json` æ–‡ä»¶ä¸­ï¼Œ`dependencies` å’Œ `peerDependencies` éƒ½ç”¨äºç®¡ç†ä¾èµ–ï¼Œä½†å®ƒä»¬çš„ç”¨é€”å’Œè¡Œä¸ºæœ‰æœ¬è´¨åŒºåˆ«ï¼š

---

### **1. dependencies**
- **ç”¨é€”**ï¼šå£°æ˜å½“å‰åŒ…**ç›´æ¥ä¾èµ–**çš„ç¬¬ä¸‰æ–¹åº“ã€‚  
- **å®‰è£…è¡Œä¸º**ï¼š  
  - å½“ç”¨æˆ·å®‰è£…ä½ çš„åŒ…æ—¶ï¼Œè¿™äº›ä¾èµ–ä¼šè¢«**è‡ªåŠ¨å®‰è£…**åˆ°ä½ çš„ `node_modules` ä¸­ã€‚  
  - å¦‚æœä¾èµ–åº“æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œnpm/yarn ä¼šé€šè¿‡åµŒå¥—å®‰è£…è§£å†³å†²çªï¼ˆä¸åŒåŒ…å¯ä½¿ç”¨å„è‡ªå…¼å®¹çš„ç‰ˆæœ¬ï¼‰ã€‚  
- **é€‚ç”¨åœºæ™¯**ï¼š  
  ä½ çš„åŒ…**è¿è¡Œæ—¶å¿…é¡»**çš„åº“ï¼ˆä¾‹å¦‚ `lodash`ã€`axios` ç­‰ï¼‰ã€‚  
- **ç¤ºä¾‹**ï¼š  
  ```json
  {
    "dependencies": {
      "lodash": "^4.17.0"
    }
  }
  ```

---

### **2. peerDependencies**
- **ç”¨é€”**ï¼šå£°æ˜å½“å‰åŒ…**éœ€è¦å®¿ä¸»ç¯å¢ƒæä¾›**çš„ä¾èµ–ï¼ˆé€šå¸¸æ˜¯å…±äº«åº“ï¼‰ã€‚  
- **å®‰è£…è¡Œä¸º**ï¼š  
  - **ä¸ä¼šè‡ªåŠ¨å®‰è£…**è¿™äº›ä¾èµ–ï¼  
  - å¦‚æœç”¨æˆ·å®‰è£…ä½ çš„åŒ…æ—¶ï¼Œå®¿ä¸»ç¯å¢ƒ**æ²¡æœ‰å®‰è£…**æŒ‡å®šçš„ä¾èµ–ï¼ˆæˆ–ç‰ˆæœ¬ä¸å…¼å®¹ï¼‰ï¼Œä¼šæŠ›å‡ºè­¦å‘Šï¼ˆnpm <7ï¼‰æˆ–é”™è¯¯ï¼ˆnpm â‰¥7ï¼‰ã€‚  
  - ç”¨æˆ·å¿…é¡»**æ‰‹åŠ¨å®‰è£…**è¿™äº›ä¾èµ–åˆ°å®¿ä¸»é¡¹ç›®ä¸­ã€‚  
- **è®¾è®¡ç›®çš„**ï¼šé¿å…**é‡å¤å®‰è£…**å’Œ**ç‰ˆæœ¬å†²çª**ï¼ˆå¼ºåˆ¶å…±äº«åŒä¸€ä»½ä¾èµ–ï¼‰ã€‚  
- **é€‚ç”¨åœºæ™¯**ï¼š  
  - æ’ä»¶ç±»åº“ï¼ˆå¦‚ `webpack-plugin` éœ€è¦å…±äº«å®¿ä¸»é¡¹ç›®çš„ `webpack`ï¼‰ã€‚  
  - ç»„ä»¶åº“ï¼ˆå¦‚ React ç»„ä»¶åº“éœ€è¦å…±äº«å®¿ä¸»é¡¹ç›®çš„ `react`ï¼‰ã€‚  
- **ç¤ºä¾‹**ï¼š  
  ```json
  {
    "peerDependencies": {
      "react": ">=16.8.0"
    }
  }
  ```

---

### **å…³é”®åŒºåˆ«æ€»ç»“**
| ç‰¹æ€§                | dependencies                  | peerDependencies                     |
|---------------------|------------------------------|--------------------------------------|
| **å®‰è£…è¡Œä¸º**        | è‡ªåŠ¨å®‰è£…åˆ°å½“å‰åŒ… `node_modules` | ä¸è‡ªåŠ¨å®‰è£…ï¼Œéœ€å®¿ä¸»ç¯å¢ƒæä¾›             |
| **ç‰ˆæœ¬å†²çªè§£å†³**    | å…è®¸åµŒå¥—å¤šç‰ˆæœ¬                | å¼ºåˆ¶å®¿ä¸»ç¯å¢ƒå…±äº«å•ç‰ˆæœ¬               |
| **é€‚ç”¨åœºæ™¯**        | ç§æœ‰ä¾èµ–ï¼ˆä»…å½“å‰åŒ…éœ€è¦ï¼‰       | å…¬å…±ä¾èµ–ï¼ˆéœ€ä¸å®¿ä¸»å…±äº«ï¼‰             |
| **ç”¨æˆ·è´£ä»»**        | æ— éœ€æ‰‹åŠ¨æ“ä½œ                  | å¿…é¡»ç¡®ä¿å®¿ä¸»ç¯å¢ƒå®‰è£…æ­£ç¡®ç‰ˆæœ¬         |
| **å…¸å‹ç”¨ä¾‹**        | `axios`, `lodash` ç­‰å·¥å…·åº“    | React ç»„ä»¶åº“ã€Webpack æ’ä»¶ç­‰         |

---

### **ä¸ºä»€ä¹ˆéœ€è¦ peerDependenciesï¼Ÿ**
å‡è®¾ä½ å¼€å‘ä¸€ä¸ª React ç»„ä»¶åº“ï¼š
- å¦‚æœå°†å…¶æ”¾å…¥ `dependencies`ï¼š  
  ç”¨æˆ·é¡¹ç›®ä¸­å¯èƒ½å®‰è£…**ä¸¤ä»½ React**ï¼ˆä½ çš„ç»„ä»¶åº“å†…ä¸€ä»½ + ç”¨æˆ·é¡¹ç›®ä¸€ä»½ï¼‰ï¼Œå¯¼è‡´æ‰“åŒ…ä½“ç§¯å¢å¤§ï¼Œç”šè‡³å¼•å‘ React ä¸Šä¸‹æ–‡é”™ä¹±ã€‚  
- ä½¿ç”¨ `peerDependencies`ï¼š  
  å¼ºåˆ¶ç»„ä»¶åº“ä¸å®¿ä¸»é¡¹ç›®**å…±äº«åŒä¸€ä»½ React**ï¼Œé¿å…é‡å¤å®‰è£…å’Œç‰ˆæœ¬å†²çªã€‚

---

### **npm ç‰ˆæœ¬å·®å¼‚**
- **npm v3-v6**ï¼šåªå¯¹ç¼ºå¤±çš„ `peerDependencies` è¾“å‡ºè­¦å‘Šï¼Œä¸é˜»å¡å®‰è£…ã€‚  
- **npm v7+**ï¼šè‡ªåŠ¨å®‰è£… `peerDependencies`ï¼ˆä½†è¦æ±‚ç‰ˆæœ¬èŒƒå›´å…¼å®¹ï¼‰ï¼Œä¸å…¼å®¹åˆ™æŠ¥é”™ã€‚  
- **Yarn**ï¼šé»˜è®¤ä¸å®‰è£…ï¼Œéœ€é…åˆ `yarn install --flat` æˆ–æ˜¾å¼æ·»åŠ åˆ°å®¿ä¸»ä¾èµ–ã€‚

---

### **æœ€ä½³å®è·µ**
1. **åº“/æ’ä»¶å¼€å‘è€…**ï¼š  
   - å°†æ ¸å¿ƒæ¡†æ¶ï¼ˆå¦‚ Reactã€Vueã€Webpackï¼‰æ”¾å…¥ `peerDependencies` + `devDependencies`ï¼ˆç”¨äºæœ¬åœ°æµ‹è¯•ï¼‰ã€‚  
   - ç§æœ‰å·¥å…·åº“æ”¾å…¥ `dependencies`ã€‚  
2. **åº”ç”¨å¼€å‘è€…**ï¼š  
   - ç›´æ¥ç®¡ç†æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬ `peerDependencies` è¦æ±‚çš„åº“ï¼‰ï¼Œæ— éœ€ç‰¹æ®Šæ“ä½œã€‚

é€šè¿‡æ­£ç¡®ä½¿ç”¨ä¸¤è€…ï¼Œå¯æ˜¾è‘—é¿å…ä¾èµ–å†²çªå’Œå†—ä½™å®‰è£…é—®é¢˜ã€‚

==================================================

å®ƒä»¬åœ¨æ‰“åŒ…çš„æ—¶å€™æœ‰æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«

==================================================

åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼ˆå¦‚ä½¿ç”¨ Webpackã€Rollup ç­‰å·¥å…·ï¼‰ï¼Œ`dependencies` å’Œ `peerDependencies` çš„å¤„ç†æ–¹å¼æœ‰æ˜¾è‘—åŒºåˆ«ï¼Œç›´æ¥å½±å“æœ€ç»ˆäº§ç‰©çš„ä½“ç§¯å’Œè¿è¡Œæ–¹å¼ï¼š

---

### **1. dependencies çš„æ‰“åŒ…è¡Œä¸º**
- **é»˜è®¤æ‰“åŒ…è¿›äº§ç‰©**  
  å·¥å…·ä¼šå°† `dependencies` ä¸­çš„æ¨¡å—è§†ä¸º**ç§æœ‰ä¾èµ–**ï¼Œç›´æ¥æ‰“åŒ…è¿›æœ€ç»ˆè¾“å‡ºæ–‡ä»¶ï¼ˆå¦‚ `dist/main.js`ï¼‰ã€‚
- **é‡å¤æ‰“åŒ…é£é™©**  
  å¦‚æœå¤šä¸ªåº“ä¾èµ–åŒä¸€ä¸ªåŒ…ï¼ˆå¦‚ `lodash`ï¼‰ï¼Œæ¯ä¸ªåº“éƒ½ä¼šå°†è‡ªå·±çš„ `lodash` æ‰“åŒ…è¿›äº§ç‰©ï¼Œå¯¼è‡´ï¼š
  ```bash
  final-bundle.js
  â”œâ”€â”€ LibraryA çš„ lodash v4.17.0 (50KB)
  â””â”€â”€ LibraryB çš„ lodash v4.17.0 (50KB)  # é‡å¤ï¼
  ```
- **é€‚ç”¨åœºæ™¯**  
  é€‚åˆ**ä¸æœŸæœ›å®¿ä¸»ç¯å¢ƒæä¾›**çš„ç§æœ‰å·¥å…·åº“ï¼ˆå¦‚å†…éƒ¨å°è£…çš„ `utils` ç­‰ï¼‰ã€‚

---

### **2. peerDependencies çš„æ‰“åŒ…è¡Œä¸º**
- **é»˜è®¤æ’é™¤åœ¨äº§ç‰©å¤–**  
  æ‰“åŒ…å·¥å…·ä¼šå°† `peerDependencies` è§†ä¸º**å¤–éƒ¨ä¾èµ–**ï¼ˆexternalsï¼‰ï¼Œ**ä¸ä¼šæ‰“åŒ…è¿›æœ€ç»ˆäº§ç‰©**ã€‚
- **ä¾èµ–å®¿ä¸»ç¯å¢ƒæä¾›**  
  åœ¨ä»£ç ä¸­ä¿ç•™ `import` è¯­å¥ï¼Œè¿è¡Œæ—¶ä»å®¿ä¸»ç¯å¢ƒçš„ `node_modules` åŠ è½½ï¼š
  ```js
  // æ‰“åŒ…åä»£ç ä¿ç•™åŸå§‹å¯¼å…¥
  import React from 'react'; // ä»å®¿ä¸»é¡¹ç›®è·å–
  ```
- **é¿å…é‡å¤æ‰“åŒ…**  
  ç¡®ä¿å¤šä¸ªåº“å…±äº«å®¿ä¸»ç¯å¢ƒçš„åŒä¸€ä»½ä¾èµ–ï¼š
  ```bash
  final-bundle.js
  â”œâ”€â”€ YourComponentLib (ä¸å« React)
  â””â”€â”€ HostProject çš„ react v18.2.0 (120KB)  # ä»…ä¸€ä»½
  ```

---

### **å…³é”®æ‰“åŒ…å·®å¼‚å¯¹æ¯”**
| ç‰¹æ€§                     | dependencies                          | peerDependencies                     |
|--------------------------|---------------------------------------|--------------------------------------|
| **æ˜¯å¦æ‰“åŒ…è¿›äº§ç‰©**       | âœ… æ˜¯                                 | âŒ å¦ï¼ˆé»˜è®¤ï¼‰                        |
| **æ‰“åŒ…å·¥å…·é…ç½®**         | è‡ªåŠ¨åŒ…å«                              | éœ€é…ä¸º `externals` (æˆ–è‡ªåŠ¨è¯†åˆ«)      |
| **äº§ç‰©ä½“ç§¯å½±å“**         | å¢å¤§ä½“ç§¯ï¼ˆå¯èƒ½é‡å¤ï¼‰                  | ä¸å¢åŠ ä½“ç§¯                           |
| **è¿è¡Œæ—¶ä¾èµ–æ¥æº**       | å½“å‰åŒ…çš„ `node_modules`               | å®¿ä¸»é¡¹ç›®çš„ `node_modules`            |
| **å…¸å‹åœºæ™¯**             | ç§æœ‰å·¥å…·å‡½æ•°ã€å†…éƒ¨åº“                  | æ¡†æ¶ç»„ä»¶(React/Vue)ã€æ’ä»¶(Webpack)   |

---

### **æ‰“åŒ…é…ç½®ç¤ºä¾‹ï¼ˆWebpackï¼‰**
```js
// webpack.config.jsï¼ˆç»„ä»¶åº“é…ç½®ï¼‰
module.exports = {
  externals: {
    // å…³é”®ï¼šå°† peerDependencies è®¾ä¸ºå¤–éƒ¨ä¾èµ–
    react: 'react',
    'react-dom': 'react-dom'
  }
};
```

---

### **ä¸ºä»€ä¹ˆ peerDependencies éœ€è¦ç‰¹æ®Šæ‰“åŒ…å¤„ç†ï¼Ÿ**
ä»¥ React ç»„ä»¶åº“ä¸ºä¾‹ï¼š
1. **é¿å…é‡å¤æ‰“åŒ…**  
   è‹¥å°† React æ‰“åŒ…è¿›ç»„ä»¶åº“ï¼Œç”¨æˆ·é¡¹ç›®ä¼šåŒæ—¶å­˜åœ¨ï¼š
   - ç»„ä»¶åº“å†…çš„ React (50KB)
   - ç”¨æˆ·é¡¹ç›®çš„ React (50KB)
   â†’ **æ€»ä½“ç§¯å¢åŠ  100KB**

2. **é¿å…ä¸Šä¸‹æ–‡å†²çª**  
   React ä¾èµ–å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆå¦‚ `React.createContext`ï¼‰ï¼Œå¤šä¸ª React å®ä¾‹ä¼šå¯¼è‡´ï¼š
   ```js
   // ç”¨æˆ·é¡¹ç›®
   import React from 'react'; // ç‰ˆæœ¬ 18
   
   // ç»„ä»¶åº“å†…éƒ¨
   import React from 'react'; // ç‰ˆæœ¬ 17 (å·²æ‰“åŒ…è¿›ç»„ä»¶)
   
   // å¯¼è‡´ Contextã€Hooks ç­‰ API å¤±æ•ˆ
   ```

---

### **peerDependencies çš„æ‰“åŒ…æ³¨æ„äº‹é¡¹**
1. **å¼€å‘ç¯å¢ƒç‰¹æ®Šå¤„ç†**  
   åœ¨ç»„ä»¶åº“çš„æœ¬åœ°å¼€å‘ä¸­ï¼Œéœ€å°† `peerDependencies` å®‰è£…åˆ° `devDependencies`ï¼š
   ```json
   {
     "peerDependencies": {
       "react": ">=16.8"
     },
     "devDependencies": {
       "react": "^18.2.0" // ç”¨äºæœ¬åœ°æµ‹è¯•å’Œæ‰“åŒ…
     }
   }
   ```

2. **Tree Shaking ä¼˜åŒ–**  
   å½“ `peerDependencies` è®¾ä¸ºå¤–éƒ¨ä¾èµ–æ—¶ï¼Œå®¿ä¸»é¡¹ç›®çš„æ‰“åŒ…å·¥å…·å¯å¯¹å…±äº«åº“åš Tree Shakingã€‚

3. **åŠ¨æ€ä¾èµ–è­¦å‘Š**  
   è‹¥ä»£ç åŠ¨æ€åŠ è½½ peer ä¾èµ–ï¼ˆå¦‚ `require('react/' + path)`ï¼‰ï¼Œéœ€æ˜¾å¼é…ç½® externalsï¼š
   ```js
   // Webpack é…ç½®
   externals: {
     react: {
       commonjs: 'react',
       commonjs2: 'react',
       amd: 'react'
     }
   }
   ```

---

### **æ€»ç»“ï¼šæ‰“åŒ…å†³ç­–æŒ‡å—**
| **ä½ çš„åŒ…ç±»å‹**       | **ä¾èµ–ç±»å‹**          | **æ‰“åŒ…å»ºè®®**                         |
|----------------------|-----------------------|--------------------------------------|
| åº”ç”¨é¡¹ç›®             | æ‰€æœ‰ä¾èµ–              | å…¨éƒ¨æ‰“åŒ…è¿›äº§ç‰©                       |
| å…¬å…±ç»„ä»¶åº“/æ’ä»¶      | æ¡†æ¶(React/Vue ç­‰)    | peerDependencies + è®¾ä¸º externals    |
| å…¬å…±ç»„ä»¶åº“/æ’ä»¶      | ç§æœ‰å·¥å…·(å¦‚å†…éƒ¨ utils)| dependencies + æ‰“åŒ…è¿›äº§ç‰©            |
| ç‹¬ç«‹è¿è¡Œçš„å·¥å…·åº“     | æ‰€æœ‰å¿…éœ€ä¾èµ–          | dependencies + æ‰“åŒ…è¿›äº§ç‰©            |

æ­£ç¡®åŒºåˆ†ä¸¤è€…å¯é¿å… **â€œæ‰“åŒ…ä½“ç§¯è†¨èƒ€â€** å’Œ **â€œå¤šå®ä¾‹å†²çªâ€** ä¸¤å¤§æ ¸å¿ƒé—®é¢˜ã€‚

==================================================

çœ‹èµ·æ¥è¿™ä¸ªæŠŠ peerDependencies è®¾ä¸º externals çš„æ­¥éª¤æ˜¯æ‰‹åŠ¨æ‰§è¡Œçš„ï¼Œé‚£å¦‚æœä¸€èˆ¬çš„ dependencies ä¹Ÿè®¾ä¸º externalsï¼Œæ‰“åŒ…çš„æ—¶å€™æœ‰åŒºåˆ«å—

==================================================

ä½ è¯´å¾—éå¸¸å¯¹ï¼**å°† `peerDependencies` è®¾ä¸º `externals` ç¡®å®æ˜¯æ‰‹åŠ¨é…ç½®çš„**ï¼Œè€Œ `dependencies` é»˜è®¤æ˜¯ä¼šè¢«æ‰“åŒ…çš„ã€‚ä½†å¦‚æœ**ä¸»åŠ¨å°† `dependencies` ä¹Ÿè®¾ä¸º `externals`**ï¼Œæ‰“åŒ…è¡Œä¸ºä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†è¿è¡Œæ—¶ä¼šäº§ç”Ÿå…³é”®å·®å¼‚ã€‚ä¸‹é¢é€šè¿‡å¯¹æ¯”å¸®ä½ å½»åº•ç†æ¸…ï¼š

---

### é…ç½®å¯¹æ¯”å®éªŒï¼ˆå‡è®¾æ‰“åŒ…å·¥å…·ä¸º Webpackï¼‰
#### åœºæ™¯è®¾å®šï¼š
```json
// package.json
{
  "name": "my-library",
  "dependencies": {
    "lodash": "^4.17.0"     // ç§æœ‰å·¥å…·
  },
  "peerDependencies": {
    "react": ">=16.8"       // å…±äº«æ¡†æ¶
  }
}
```

#### 1. **é»˜è®¤è¡Œä¸ºï¼ˆä¸é…ç½® externalsï¼‰**
| ä¾èµ–ç±»å‹          | æ˜¯å¦æ‰“åŒ…è¿›äº§ç‰© | è¿è¡Œæ—¶æ¥æº               | é£é™©                     |
|-------------------|----------------|--------------------------|--------------------------|
| `dependencies`    | âœ… æ˜¯          | å½“å‰åº“çš„ `node_modules`  | æ—                        |
| `peerDependencies`| âŒ å¦          | å®¿ä¸»é¡¹ç›®çš„ `node_modules`| **å®¿ä¸»æœªå®‰è£…åˆ™æŠ¥é”™**     |

#### 2. **æ‰‹åŠ¨å°† `lodash` (dependencies) è®¾ä¸º externals**
```js
// webpack.config.js
module.exports = {
  externals: {
    lodash: 'lodash'  // å…³é”®ï¼šå¼ºåˆ¶å¤–éƒ¨åŒ–
  }
};
```

| ä¾èµ–ç±»å‹          | æ˜¯å¦æ‰“åŒ…è¿›äº§ç‰© | è¿è¡Œæ—¶æ¥æº               | é£é™©                                |
|-------------------|----------------|--------------------------|-------------------------------------|
| `dependencies`    | âŒ å¦          | å®¿ä¸»é¡¹ç›®çš„ `node_modules`| **å®¿ä¸»æœªå®‰è£…åˆ™æŠ¥é”™**                |
| `peerDependencies`| âŒ å¦          | å®¿ä¸»é¡¹ç›®çš„ `node_modules`| **å®¿ä¸»æœªå®‰è£…åˆ™æŠ¥é”™**                |

---

### å…³é”®åŒºåˆ«è§£æ
#### ğŸ”¥ æ ¸å¿ƒå·®å¼‚ï¼š**å®‰è£…è´£ä»»æ–¹ä¸åŒ**
| ä¾èµ–ç±»å‹          | è®¾ä¸º externals åçš„å®é™…è¡Œä¸º                          | è´£ä»»æ–¹       |
|-------------------|------------------------------------------------------|--------------|
| `peerDependencies`| ç¬¦åˆé¢„æœŸï¼Œå®¿ä¸»**å¿…é¡»å®‰è£…**ï¼ˆæœ¬æ¥å°±æ˜¯å®¿ä¸»è´£ä»»ï¼‰       | âœ… åˆç†      |
| `dependencies`    | **è½¬å«è´£ä»»**ï¼Œå®¿ä¸»**æ„å¤–æ‰¿æ‹…**äº†æœ¬ä¸è¯¥å®‰è£…çš„ä¾èµ–     | âŒ ä¸åˆç†    |

#### âš ï¸ é£é™©ç¤ºæ„å›¾ï¼š
```mermaid
graph LR
    A[å®¿ä¸»é¡¹ç›®] --> B[ä½¿ç”¨ my-library]
    B --> C{ä¾èµ–æ£€æŸ¥}
    C -->|éœ€è¦ react| D[å®¿ä¸»å·²å®‰è£…]    %% peerDependency åˆç†
    C -->|éœ€è¦ lodash| E[å®¿ä¸»æœªå®‰è£…]   %% dependency å¤–éƒ¨åŒ–å¯¼è‡´é”™è¯¯
    E --> F[è¿è¡Œæ—¶å´©æºƒï¼šCannot find module 'lodash']
```

---

### ä¸ºä»€ä¹ˆä¸èƒ½éšæ„å°† dependencies å¤–éƒ¨åŒ–ï¼Ÿ
#### 1. **ç ´åå°è£…æ€§**
   - ä½ çš„åº“å®£ç§°ï¼šâ€æˆ‘è‡ªå¸¦ `lodash`ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒâ€œ
   - ä½†å¤–éƒ¨åŒ–åå®é™…å˜æˆï¼šâ€æˆ‘ç”¨ `lodash`ï¼Œä½†ç”¨æˆ·å¾—è‡ªå·±è£…â€œ
   - **ç›¸å½“äºæŠŠç§æœ‰ä¾èµ–å˜æˆäº†éšå½¢çš„ peerDependency**

#### 2. **ç‰ˆæœ¬å†²çªé£é™©**
   - ä½ çš„åº“æµ‹è¯•çš„æ˜¯ `lodash@4.17.0`
   - å®¿ä¸»é¡¹ç›®è£…äº† `lodash@3.0.0`ï¼ˆæ—§ç‰ˆç¼ºå°‘æŸäº› APIï¼‰
   - **è¿è¡Œæ—¶æŠ¥é”™**ï¼š`this.merge is not a function`ï¼ˆå®é™…æ˜¯ `_.merge` åœ¨ v3 ä¸å­˜åœ¨ï¼‰

#### 3. **å®‰è£…è¯­ä¹‰æ··æ·†**
   - ç”¨æˆ·çœ‹åˆ° `package.json` ä¸­åªæœ‰ `"my-library": "^1.0.0"`
   - å®‰è£…åå´è¦æ±‚æ‰‹åŠ¨è£… `lodash`ï¼ˆç”¨æˆ·ï¼šï¼Ÿï¼Ÿï¼Ÿï¼‰

---

### ä½•æ—¶å¯ä»¥ä¸»åŠ¨å¤–éƒ¨åŒ– dependenciesï¼Ÿ
#### âœ… åˆç†åœºæ™¯ï¼š
1. **å¾®å‰ç«¯å…±äº«ä¾èµ–**  
   ä¸»åº”ç”¨å·²é€šè¿‡ `<script>` å…¨å±€æš´éœ² `lodash`ï¼Œå­åº”ç”¨å¤ç”¨ï¼š
   ```js
   // webpack.config.js
   externals: {
     lodash: '_' // æ˜ å°„åˆ°å…¨å±€å˜é‡
   }
   ```

2. **CDN ä¾èµ–ä¼˜åŒ–**  
   å¤§å‹åº“ï¼ˆå¦‚ three.jsï¼‰é€šè¿‡ CDN å¼•å…¥ï¼š
   ```html
   <!-- å®¿ä¸» HTML -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
   ```
   ```js
   // webpack.config.js
   externals: {
     'three': 'THREE'
   }
   ```

#### â›” é”™è¯¯åœºæ™¯ï¼š
```js
// åæ¨¡å¼ï¼šå°†ç§æœ‰å·¥å…·åº“å¤–éƒ¨åŒ–
externals: {
  'internal-utils': 'internalUtils' // å®¿ä¸»æ ¹æœ¬ä¸çŸ¥é“è¦è£…å®ƒï¼
}
```

---

### æœ€ä½³å®è·µæ€»ç»“
| æ“ä½œ                     | æ¨èåº¦ | è¯´æ˜                                                                 |
|--------------------------|--------|----------------------------------------------------------------------|
| peerDependencies + externals | â­â­â­â­â­ | æ ‡å‡†åšæ³•ï¼Œé¿å…é‡å¤æ‰“åŒ…æ¡†æ¶ä¾èµ–                                       |
| dependencies ä¸å¤„ç†      | â­â­â­â­â­ | ç§æœ‰ä¾èµ–åº”æ‰“åŒ…è¿›äº§ç‰©ï¼Œä¿æŒå°è£…æ€§                                     |
| dependencies + externals | â­â˜†     | ä»…åœ¨å®¿ä¸»**æ˜ç¡®å…¨å±€æä¾›**æ—¶ä½¿ç”¨ï¼ˆå¦‚ CDN/å¾®å‰ç«¯ï¼‰ï¼Œéœ€å¼ºçº¦å®š            |
| peerDependencies ä¸å¤–éƒ¨åŒ– | âš ï¸ ç¦æ­¢ | ä¼šå¯¼è‡´æ¡†æ¶è¢«æ‰“åŒ…è¿›åº“ï¼Œå¼•å‘é‡å¤å®‰è£…å’Œä¸Šä¸‹æ–‡é”™ä¹±                       |

---

### ç»ˆæå†³ç­–æ ‘
```mermaid
graph TD
    A[æˆ‘çš„ä¾èµ–] --> B{æ˜¯å¦æœŸæœ›å®¿ä¸»å®‰è£…ï¼Ÿ}
    B -->|æ˜¯ï¼šæ¡†æ¶/æ’ä»¶| C[peerDependencies + è®¾ä¸º externals]
    B -->|å¦ï¼šç§æœ‰å·¥å…·| D[dependencies + ä¸è®¾ externals]
    D --> E{æ˜¯å¦éœ€CDN/å¾®å‰ç«¯å…±äº«ï¼Ÿ}
    E -->|æ˜¯| F[ä¸»åŠ¨ externals + æ–‡æ¡£è¯´æ˜]
    E -->|å¦| G[é»˜è®¤æ‰“åŒ…è¿›äº§ç‰©]
```

**ç®€å•è¯´ï¼š**  
`peerDependencies` + `externals` = â€æˆ‘ç”¨å®¿ä¸»çš„ç¯å¢ƒâ€œ  
`dependencies` ä¸å¤„ç† = â€æˆ‘è‡ªå¸¦å¹²ç²®ï¼Œè‡ªç»™è‡ªè¶³â€œ

==================================================

